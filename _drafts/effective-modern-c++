---
layout: post
title: effective modern c++
categories: dev
tags: c++
---

# std::move
 - 인수를 무조건 rvalue 로 캐스팅한다.
 - 컴파일러에게 그 객체가 이동에 적합하다는 것을 알려주는 캐스팅을 수행할 뿐 이동을 수행하지 않는다.
 
```c++
class annotation
{
public:
	explicit annotation(cons std::string text)
	: value(std::move(text))			// text 를 value로 '이동'한다.
	{						// 이 코드는 보기와는 다르게 작동한다.
	}
};
```

 - text 가 value로 이동하는 것이 아니라 복사된다. 
 - std::move 때문에 text 가 rvalue로 캐스팅되는 것은 확실하다.
 - text는 lvalue const std::string 에서 rvalue const std::string 으로 캐스팅된다. const 가 유지된다.
 - 이동 생성자는 const 가 아닌 std::string 의 rvalue 참조를 받는다.
 - rvalue 는 복사생성자에 전달될 수 있다.
 - 이동은 객체를 수정하는 행위이니 const 객체가 이동이 안되는 것은 당연하다.
 - 이동을 지원하려면 const 로 선언하면 안되며, std::move는 단지 rvalue 로 형변환 할뿐이다.


# std::move 와 std::forward
 - std::move는 모든 것을 이동하지는 않는다.
 - std::forward는 모든 것을 전달하지는 않는다.
 - std::move와 std::forward는 그냥 캐스팅을 수행하는 함수 템플릿이다. 
 - std::move는 인수를 무조건 rvalue로 캐스팅한다.
 - std::forward는 인수가 특정 조건을 만족할 때에 rvalue로 캐스팅한다.
 - std::move는 캐스팅을 수행할 뿐 이동을 수행하지 않는다. 컴파일러에게 그 객체가 이동에 적합하다는 것을 말해주는 것이다. 
 
 
 
layout: post
title: baidu push c# 구현
categories: dev
tags: baidu push c# dev
---
# reference
- [http://push.baidu.com/doc/restapi/restapi](http://push.baidu.com/doc/restapi/sdk_developer)
- [http://push.baidu.com/doc/restapi/sdk_developer](http://push.baidu.com/doc/restapi/sdk_developer)

# 유의할 점
- baidu 의 push server 가 php 로 구현되어있는지 php 의 urlencode 를 구현해야 한다. php 의 urlencode 는 공백(%20)을 '+' 로 대체한다. 

```c#
TimeSpan t = DateTime.Now - new DateTime(1970, 1, 1);
int totalSeconds = (int)t.TotalSeconds;
string timestamp = totalSeconds.ToString();                

SortedDictionary<string, string> param = new SortedDictionary<string, string>();
param["apikey"] = _setting.ApiKey;
param["timestamp"] = timestamp;
param["channel_id"] = baiduNotification.ChannelId;
param["msg"] = baiduNotification.Msg;

if (baiduNotification.MsgType.HasValue)
{
	param["msg_type"] = baiduNotification.MsgType.Value.ToString();
}

if (baiduNotification.DeployStatus.HasValue)
{
	param["deploy_status"] = baiduNotification.DeployStatus.Value.ToString();
}                

string parameterString = "";

foreach (KeyValuePair<string, string> pair in param)
{
	parameterString += pair.Key + "=" + pair.Value;
}

string baseString = _setting.Method + _setting.Url + parameterString + _setting.SecretKey;

string escapedDataString = Uri.EscapeDataString(baseString);
string urlencodedString = escapedDataString.Replace("%20", "+");

string hashedString = "";
using (MD5 md5 = MD5.Create())
{
	byte[] data = md5.ComputeHash(Encoding.UTF8.GetBytes(urlencodedString));

	StringBuilder builder = new StringBuilder();

	for (int i = 0; i < data.Length; ++i)
	{
		builder.Append(data[i].ToString("x2"));
	}

	hashedString = builder.ToString();
}

param["sign"] = hashedString;

string content = "";                
foreach (KeyValuePair<string, string> pair in param)
{
	if (0 < content.Length)
		content += "&";

	content += pair.Key + "=" + pair.Value;
}

HttpClient client = new HttpClient();                    
client.DefaultRequestHeaders.UserAgent.TryParseAdd("BCCS_SDK/3.0 (Darwin; Darwin Kernel Version 14.0.0: Fri Sep 19 00:26:44 PDT 2014; root:xnu-2782.1.97~2/RELEASE_X86_64; x86_64) PHP/5.6.3 (Baidu Push Server SDK V3.0.0 and so on..) cli/Unknown ZEND/2.6.0");

StringContent stringContent = new StringContent(content, Encoding.UTF8, "application/x-www-form-urlencoded");
Httpㅐㅑㅇ
  ```

 


# 참조 축약
# 완벽 전달의 실패

# reference
- [http://push.baidu.com/doc/restapi/restapi](http://push.baidu.com/doc/restapi/sdk_developer)
- [http://push.baidu.com/doc/restapi/sdk_developer](http://push.baidu.com/doc/restapi/sdk_developer)

# 유의할 점
- baidu 의 push server 가 php 로 구현되어있는지 php 의 urlencode 를 구현해야 한다. php 의 urlencode 는 공백(%20)을 '+' 로 대체한다. 

```c#
TimeSpan t = DateTime.Now - new DateTime(1970, 1, 1);
int totalSeconds = (int)t.TotalSeconds;
string timestamp = totalSeconds.ToString();                

SortedDictionary<string, string> param = new SortedDictionary<string, string>();
param["apikey"] = _setting.ApiKey;
param["timestamp"] = timestamp;
param["channel_id"] = baiduNotification.ChannelId;
param["msg"] = baiduNotification.Msg;

if (baiduNotification.MsgType.HasValue)
{
	param["msg_type"] = baiduNotification.MsgType.Value.ToString();
}

if (baiduNotification.DeployStatus.HasValue)
{
	param["deploy_status"] = baiduNotification.DeployStatus.Value.ToString();
}                

string parameterString = "";

foreach (KeyValuePair<string, string> pair in param)
{
	parameterString += pair.Key + "=" + pair.Value;
}

string baseString = _setting.Method + _setting.Url + parameterString + _setting.SecretKey;

string escapedDataString = Uri.EscapeDataString(baseString);
string urlencodedString = escapedDataString.Replace("%20", "+");

string hashedString = "";
using (MD5 md5 = MD5.Create())
{
	byte[] data = md5.ComputeHash(Encoding.UTF8.GetBytes(urlencodedString));

	StringBuilder builder = new StringBuilder();

	for (int i = 0; i < data.Length; ++i)
	{
		builder.Append(data[i].ToString("x2"));
	}

	hashedString = builder.ToString();
}

param["sign"] = hashedString;

string content = "";                
foreach (KeyValuePair<string, string> pair in param)
{
	if (0 < content.Length)
		content += "&";

	content += pair.Key + "=" + pair.Value;
}

HttpClient client = new HttpClient();                    
client.DefaultRequestHeaders.UserAgent.TryParseAdd("BCCS_SDK/3.0 (Darwin; Darwin Kernel Version 14.0.0: Fri Sep 19 00:26:44 PDT 2014; root:xnu-2782.1.97~2/RELEASE_X86_64; x86_64) PHP/5.6.3 (Baidu Push Server SDK V3.0.0 and so on..) cli/Unknown ZEND/2.6.0");

StringContent stringContent = new StringContent(content, Encoding.UTF8, "application/x-www-form-urlencoded");
HttpResponseMessage response = client.PostAsync(_setting.Url, stringContent).Result;
```
