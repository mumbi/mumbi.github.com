---
layout: post
title: effective modern c++
categories: dev
tags: c++
---

# 특별한 멤버 함수들의 자동 작성 조건
 - C++98: 기본 생성자, 소멸자, 복사 생성자, 복사 연산자
 - C++11: 이동 생성자, 이동 연산자 추가

```c++
class widget
{
public:
	widget(widget&& rhs);			// 이동 생성자
	widget& operator=(widget&& rhs);	// 이동 연산자
};
```

## 3의 법칙(Rule of Three)
 - 만일 복사 생성자와 복새 연산자, 소멸자 중 하나라도 선언했다면 모두 선언해야 한다.

## 복사 연산 자동 작성 조건
 - 복사 생성자를 선언했고, 복사 연산자를 선언하지 않았지만 복사 연산자가 쓰인다면 컴파일러는 복사 연산자를 작성한다. 
 - 복사 연산자를 선언했고, 복사 생성자를 선언하지 않았지만 복사 생성자가 쓰인다면 컴파일러는 복사 생성자를 작성한다.
 
## 이동 연산 자동 작성 조건
 - 클래스에 어떤 복사 연산도 선언되어 있지 않다.
 - 클래스에 어떤 이동 연산도 선언되어 있지 않다.
 - 클래스에 소멸자가 선언되어 있지 않다.
 
## 기본 연산 활성화
 - C++11에서는 기본 행동을 사용하겠다는 의사를 "= default"를 이용해서 명시적으로 표현할 수 있다.
 
```c++
class widget
{
public:
	~widget();					// 사용자 선언 소멸자
	widget(const widget&) = default;		// 기본 복사 생성자
	widget& operator=(const widget&) = default;	// 기본 복사 연산자
};
```

 - 다형적 기반 클래스에는 가상 소멸자가 있는데 복사 연산과 이동 연산 모두 기본 행동이 필요할때 "= default"를 지정하면 된다.
 
```c++
class base
{
pubilc:
	virtual ~base() = default;		// 가상 소멸자
	
	base(base&&) = default;			// 기본 이동
	base& operator=(base&&) = default;
	
	base(const base&) = default;		// 기본 복사
	base& operator=(const base&) = default;	
};
```

## C++11 의 특별한 멤버 함수 규칙

### 기본 생성자
 - C++98 의 규칙들과 같다. 
 - 클래스에 사용자 선언 생성자가 없는 경우에만 자동으로 작성된다.
 
### 소멸자
 - C++98 의 규칙들과 같다.
 - 기본적으로 noexcept 이다. 
 - 기반 클래스 소멸자가 가상일 때에는 자동 작성되는 소멸자도 가상이다.
 
### 복사 생성자
 - 실행시점 행동은 C++98 과 같다.
 - 비정적 자료 멤버들은 멤버별로 복사 생성한다.
 - 클래스에 사용자 선언 복사 생성자가 없을 때에만 자동으로 작성된다.
 - 클래스에 이동 연산이 하나라도 선언되어 있으면 삭제된다.
 - 사용자 선언 복사 연산자나 소멸자가 있는 클래스에서 이 함수가 자동 작성되는 기능은 비권장이다.

### 복사 연산자
 - 실행시점 행동은 C++98 과 같다.
 - 비정적 자료 멤버들을 멤버별로 복사한다.
 - 클래스에 사용자 선언 복사 연산자가 없을 때에만 자동으로  
 - 클래스에 이동 연산이 하나라도 선언되어 있으면 삭제된다.
 - 사용자 선언 복사 생성자나 소멸자가 잇는 클래스에서 이 함수가 자동 작성되는 기능은 비권장이다.
 
### 이동 생성자, 이동 연산자
 - 비정적 자료 멤버의 멤버별 이동을 수행한다.
 - 클래스에 사용자 선언 복사 연산들과 이동 연산들, 소멸자가 없을 때에만 작성된다.
 
 
 
 
 
layout: post
title: baidu push c# 구현
categories: dev
tags: baidu push c# dev
---
# reference
- [http://push.baidu.com/doc/restapi/restapi](http://push.baidu.com/doc/restapi/sdk_developer)
- [http://push.baidu.com/doc/restapi/sdk_developer](http://push.baidu.com/doc/restapi/sdk_developer)

# 유의할 점
- baidu 의 push server 가 php 로 구현되어있는지 php 의 urlencode 를 구현해야 한다. php 의 urlencode 는 공백(%20)을 '+' 로 대체한다. 

```c#
TimeSpan t = DateTime.Now - new DateTime(1970, 1, 1);
int totalSeconds = (int)t.TotalSeconds;
string timestamp = totalSeconds.ToString();                

SortedDictionary<string, string> param = new SortedDictionary<string, string>();
param["apikey"] = _setting.ApiKey;
param["timestamp"] = timestamp;
param["channel_id"] = baiduNotification.ChannelId;
param["msg"] = baiduNotification.Msg;

if (baiduNotification.MsgType.HasValue)
{
	param["msg_type"] = baiduNotification.MsgType.Value.ToString();
}

if (baiduNotification.DeployStatus.HasValue)
{
	param["deploy_status"] = baiduNotification.DeployStatus.Value.ToString();
}                

string parameterString = "";

foreach (KeyValuePair<string, string> pair in param)
{
	parameterString += pair.Key + "=" + pair.Value;
}

string baseString = _setting.Method + _setting.Url + parameterString + _setting.SecretKey;

string escapedDataString = Uri.EscapeDataString(baseString);
string urlencodedString = escapedDataString.Replace("%20", "+");

string hashedString = "";
using (MD5 md5 = MD5.Create())
{
	byte[] data = md5.ComputeHash(Encoding.UTF8.GetBytes(urlencodedString));

	StringBuilder builder = new StringBuilder();

	for (int i = 0; i < data.Length; ++i)
	{
		builder.Append(data[i].ToString("x2"));
	}

	hashedString = builder.ToString();
}

param["sign"] = hashedString;

string content = "";                
foreach (KeyValuePair<string, string> pair in param)
{
	if (0 < content.Length)
		content += "&";

	content += pair.Key + "=" + pair.Value;
}

HttpClient client = new HttpClient();                    
client.DefaultRequestHeaders.UserAgent.TryParseAdd("BCCS_SDK/3.0 (Darwin; Darwin Kernel Version 14.0.0: Fri Sep 19 00:26:44 PDT 2014; root:xnu-2782.1.97~2/RELEASE_X86_64; x86_64) PHP/5.6.3 (Baidu Push Server SDK V3.0.0 and so on..) cli/Unknown ZEND/2.6.0");

StringContent stringContent = new StringContent(content, Encoding.UTF8, "application/x-www-form-urlencoded");
Httpㅐㅑㅇ
  ```

 

# std::move 와 std::forward
# 참조 축약
# 완벽 전달의 실패

# reference
- [http://push.baidu.com/doc/restapi/restapi](http://push.baidu.com/doc/restapi/sdk_developer)
- [http://push.baidu.com/doc/restapi/sdk_developer](http://push.baidu.com/doc/restapi/sdk_developer)

# 유의할 점
- baidu 의 push server 가 php 로 구현되어있는지 php 의 urlencode 를 구현해야 한다. php 의 urlencode 는 공백(%20)을 '+' 로 대체한다. 

```c#
TimeSpan t = DateTime.Now - new DateTime(1970, 1, 1);
int totalSeconds = (int)t.TotalSeconds;
string timestamp = totalSeconds.ToString();                

SortedDictionary<string, string> param = new SortedDictionary<string, string>();
param["apikey"] = _setting.ApiKey;
param["timestamp"] = timestamp;
param["channel_id"] = baiduNotification.ChannelId;
param["msg"] = baiduNotification.Msg;

if (baiduNotification.MsgType.HasValue)
{
	param["msg_type"] = baiduNotification.MsgType.Value.ToString();
}

if (baiduNotification.DeployStatus.HasValue)
{
	param["deploy_status"] = baiduNotification.DeployStatus.Value.ToString();
}                

string parameterString = "";

foreach (KeyValuePair<string, string> pair in param)
{
	parameterString += pair.Key + "=" + pair.Value;
}

string baseString = _setting.Method + _setting.Url + parameterString + _setting.SecretKey;

string escapedDataString = Uri.EscapeDataString(baseString);
string urlencodedString = escapedDataString.Replace("%20", "+");

string hashedString = "";
using (MD5 md5 = MD5.Create())
{
	byte[] data = md5.ComputeHash(Encoding.UTF8.GetBytes(urlencodedString));

	StringBuilder builder = new StringBuilder();

	for (int i = 0; i < data.Length; ++i)
	{
		builder.Append(data[i].ToString("x2"));
	}

	hashedString = builder.ToString();
}

param["sign"] = hashedString;

string content = "";                
foreach (KeyValuePair<string, string> pair in param)
{
	if (0 < content.Length)
		content += "&";

	content += pair.Key + "=" + pair.Value;
}

HttpClient client = new HttpClient();                    
client.DefaultRequestHeaders.UserAgent.TryParseAdd("BCCS_SDK/3.0 (Darwin; Darwin Kernel Version 14.0.0: Fri Sep 19 00:26:44 PDT 2014; root:xnu-2782.1.97~2/RELEASE_X86_64; x86_64) PHP/5.6.3 (Baidu Push Server SDK V3.0.0 and so on..) cli/Unknown ZEND/2.6.0");

StringContent stringContent = new StringContent(content, Encoding.UTF8, "application/x-www-form-urlencoded");
HttpResponseMessage response = client.PostAsync(_setting.Url, stringContent).Result;
```
